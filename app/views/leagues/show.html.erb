<p id="notice"><%= notice %></p>

<h1><%= @league.title %> current standings</h1>

<%= form_for :league_night, url: create_groups_league_night_path(@league.league_nights.last), method: :post do |f| %>

	<table>

		<tr>
			<td>Name</td><td>Average</td><td>Points</td><td>1st</td><td>2nd</td><td>3rd</td><td>4th</td><td>BP</td><td>Games</td><td>Weeks</td>
			<% @league.league_nights.each_with_index do |league_night, week| %>
				<td><%= link_to "W#{week + 1}", league_night_path(league_night)%></td>
			<% end %>
			<% if @admin %>
				<td><%= link_to "Create", new_league_night_path(league_id: @league) %></td>
			<% end %>
		</tr>
		<% @league.players.each do |player| %>
			<tr><td><%= player.name %></td><td><%= player.average_score(@league) %></td><td><%= player.points(@league) %></td>

				<td><%= player.score_distribution(@league)[4] %></td><td><%= player.score_distribution(@league)[3] %></td><td><%= player.score_distribution(@league)[2] %></td><td><%= player.score_distribution(@league)[1] %></td><td><%= player.bonus_points(@league) %></td>
				<td><%= player.games_played(@league) %></td><td><%= player.games_played(@league) / 5 %></td>
				<% @league.league_nights.each do |league_night| %>
					<% if @admin == false || league_night != @league.league_nights.last %>
						<td><%= player.points(league_night) %></td>
					<% elsif player.group(league_night) == nil %>
						<td><%= fields_for :player do |player_fields| %>
								<%= player_fields.check_box player.id, checked: true %>
							<% end %>
						</td>
					<% else %>
						<td>Group <%= player.group(league_night).group_rank %></td>
					<% end %>
				<% end %>
				<% if @admin %>
					<td>Create</td>
				<% end %>
			</tr>
		<% end %>
	</table>
	<% if @admin %>
	  <div class="actions">
	    <%= f.submit "Generate groups" %>
  	  </div>
  	<% end %>

<% end %>

<br/><br/>

<%= link_to 'Edit', edit_league_path(@league) %> |
<%= link_to 'Back', leagues_path %>
